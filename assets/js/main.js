$(document).ready(function () {


    $(document).ready(function () {
        const navbar = $('.sticky-navbar');

        // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ navbar Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±
        $(window).on('scroll', function () {
            if ($(window).scrollTop() > 50) {
                navbar.addClass('scrolled');
            } else {
                navbar.removeClass('scrolled');
            }
        });

        // Ø²Ø± ÙØªØ­ Ø§Ù„Ø³Ù„Ø©
        $("#cart-button").click(function () {
            $("#cart-sidebar").addClass("open");
        });

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let currentPage = window.location.pathname.split("/").pop();
        if (currentPage === "" || currentPage === "ecommerce-project") {
            currentPage = "index.html";
        }

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ navbar
        $(".navbar-nav .nav-link").each(function () {
            const linkPage = $(this).attr("href");
            if (linkPage === currentPage) {
                $(this).addClass("activenav");
            }
        });

        // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        $(".navbar-nav .nav-link").on("click", function (e) {
            const href = $(this).attr("href");

            if (href !== currentPage) {
                e.preventDefault();

                $(".navbar-nav .nav-link").removeClass("activenav");
                $(this).addClass("activenav");

                $("body").fadeOut(600, "swing", function () {
                    window.location.href = href;
                });
            }
        });
    });
    


    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„
    $("#navbar-placeholder").load("components/header.html", function () {
        const navbar = $('.sticky-navbar');
        $(window).on('scroll', function () {
            if ($(window).scrollTop() > 50) {
                navbar.addClass('scrolled');
            } else {
                navbar.removeClass('scrolled');
            }
        });
        // Ø²Ø± ÙØªØ­ Ø§Ù„Ø³Ù„Ø©
        $("#cart-button").click(function () {
            $("#cart-sidebar").addClass("open");
        });

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let currentPage = window.location.pathname.split("/").pop();
        if (currentPage === "" || currentPage === "ecommerce-project") {
            currentPage = "index.html";
        }

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
        $(".navbar-nav .nav-link").each(function () {
            const linkPage = $(this).attr("href");
            if (linkPage === currentPage) {
                $(this).addClass("activenav");
            }
        });

        // Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        $(".navbar-nav .nav-link").on("click", function (e) {
            const href = $(this).attr("href");

            if (href !== currentPage) {
                e.preventDefault();

                $(".navbar-nav .nav-link").removeClass("activenav");
                $(this).addClass("activenav");

                $("body").fadeOut(600, "swing", function () {
                    window.location.href = href;
                });
            }
        });
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØªØ±
    $("#footer-placeholder").load("components/footer.html");

    // Ø²Ø± ØºÙ„Ù‚ Ø§Ù„Ø³Ù„Ø©
    $(document).on("click", "#close-cart", function () {
        $("#cart-sidebar").removeClass("open");
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
    $(document).mouseup(function (e) {
        let sidebar = $("#cart-sidebar");
        if (!sidebar.is(e.target) && sidebar.has(e.target).length === 0) {
            sidebar.removeClass("open");
        }
    });

    function updateCartBadge() {
        let totalItems = 0;

        $("#cart-items .cart-item").each(function () {
            const qty = parseInt($(this).find(".quantity").text());
            totalItems += qty;
        });

        $("#cart-button .badge").text(totalItems);
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
    $(document).on("click", ".add-to-cart", function () {
        const title = $(this).data("title");
        const price = $(this).data("price");
        const image = $(this).data("image");

        const existingItem = $(`#cart-items .cart-item[data-title="${title}"]`);

        if (existingItem.length > 0) {
            const qtySpan = existingItem.find(".quantity");
            let qty = parseInt(qtySpan.text());
            qty++;
            qtySpan.text(qty);
        } else {
            const cartItem = `
                <div class="cart-item d-flex justify-content-between align-items-center border-bottom pb-2 mb-2" data-title="${title}">
                    <div class="d-flex align-items-center gap-2">
                        <img src="${image}" alt="${title}" width="50" class="rounded" />
                        <div>
                            <p class="mb-0 small fw-bold">${title}</p>
                            <span class="small text-muted">${price} SR</span>
                            <div class="quantity-controls mt-1">
                                <button class="btn btn-sm btn-outline-secondary decrease-qty">-</button>
                                <span class="quantity">1</span>
                                <button class="btn btn-sm btn-outline-secondary increase-qty">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-danger remove-item">Ã—</button>
                </div>
            `;
            const newItem = $(cartItem).css("display", "none").fadeIn(500);
            $("#cart-items").prepend(newItem);
            $(".empty-cart").remove();
        }

        // âœ… ÙØªØ­ Ø§Ù„Ø³Ø§ÙŠØ¯ Ø¨Ø§Ø±
        $("#cart-sidebar").addClass("open");

        // âœ… ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø§Ø±Ø© (badge)
        updateCartBadge();
    });


    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ©
    $(document).on("click", ".increase-qty", function () {
        const qtySpan = $(this).siblings(".quantity");
        let qty = parseInt(qtySpan.text());
        qty++;
        qtySpan.text(qty);
        updateCartBadge();
    });

    // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©
    $(document).on("click", ".decrease-qty", function () {
        const qtySpan = $(this).siblings(".quantity");
        let qty = parseInt(qtySpan.text());
        if (qty > 1) {
            qty--;
            qtySpan.text(qty);
        }
        updateCartBadge();

    });

    // Ø¥Ø²Ø§Ù„Ø© Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
    $(document).on("click", ".remove-item", function () {
        $(this).closest(".cart-item").fadeOut(400, function () {
            $(this).remove();

            if ($("#cart-items .cart-item").length === 0) {
                $("#cart-items").html('<p class="text-muted empty-cart">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>');
            }
        });
        updateCartBadge();

    });

    // Ø£Ù†Ù…ÙŠØ´Ù† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    $("body").css("display", "none").fadeIn(600, "swing");
    // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    function handleFilterChange(filter) {
        console.log("Filter selected:", filter);
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù…ÙˆØ°Ø¬ "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§"
    $('#contactForm').on('submit', function (e) {
        e.preventDefault();

        const name = $.trim($('#name').val());
        const email = $.trim($('#email').val());
        const phone = $.trim($('#phone').val());
        const message = $.trim($('#message').val());

        if (name === '' || email === '' || phone === '' || message === '') {
            showAlert('Ù…Ù† ÙØ¶Ù„Ùƒ Ù‚Ù… Ø¨Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.', 'danger');
            return;
        }

        if (!validateEmail(email)) {
            showAlert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.', 'danger');
            return;
        }

        if (!validatePhone(phone)) {
            showAlert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 10 Ø¥Ù„Ù‰ 12 Ø±Ù‚Ù…Ù‹Ø§ ÙÙ‚Ø·.', 'danger');
            return;
        }

        const formData = { name, email, phone, message };
        console.log('Form Data:', formData);
        showAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰', 'success');
        $('#contactForm')[0].reset();
    });

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯
    function validateEmail(email) {
        const re = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,}$/;
        return re.test(email);
    }

    function validatePhone(phone) {
        const re = /^\d{10,12}$/;
        return re.test(phone);
    }

    function showAlert(message, type) {
        $('#alertBox')
            .removeClass()
            .addClass(`alert alert-${type}`)
            .text(message)
            .removeClass('d-none');
    }

    // // Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    // $('#loginForm').on('submit', function (e) {
    //     e.preventDefault();

    //     const email = $('#email').val().trim();
    //     const alertBox = $('#loginAlert');

    //     if (email === '') {
    //         showAlertLogin('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.', 'danger');
    //         return;
    //     }

    //     if (!validateEmail(email)) {
    //         showAlertLogin('ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.', 'danger');
    //         return;
    //     }

    //     showAlertLogin('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ”ï¸', 'success');
    //     console.log({ email });
    // });

    // function showAlertLogin(message, type) {
    //     $('#loginAlert')
    //         .removeClass('d-none alert-danger alert-success')
    //         .addClass('alert alert-' + type)
    //         .text(message);
    // }

    $('#loginForm').on('submit', function (e) {
        e.preventDefault();

        const email = $('#email').val().trim();
        const alertBox = $('#loginAlert');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        // âœ… Ù„Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙØ§Ø¶ÙŠ
        if (email === '') {
            alertBox
                .removeClass('d-none')
                .removeClass('alert-success')
                .addClass('alert-danger')
                .text('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
            return;
        }

        // âœ… Ù„Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø´ ØµØ­ÙŠØ­
        if (!emailRegex.test(email)) {
            alertBox
                .removeClass('d-none')
                .removeClass('alert-success')
                .addClass('alert-danger')
                .text('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
            return;
        }

        // âœ… Ù„Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ØµØ­ÙŠØ­
        alertBox.addClass('d-none');

        // Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        window.location.href = '/loginVervicationCode.html';
    });

    $('#verifyForm').on('submit', function (e) {
        e.preventDefault();

        const code = $('#code').val().trim();
        const alertBox = $('#verifyAlert');

        if (!/^\d{6}$/.test(code)) {
            alertBox
                .removeClass('d-none')
                .removeClass('alert-success')
                .addClass('alert-danger')
                .text('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·');
            return;
        }

        // âœ… Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­
        alertBox.addClass('d-none');

        // Ù…Ù…ÙƒÙ† ØªØ­Ø· Ù‡Ù†Ø§ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© ØªØ­Ù‚Ù‚ Ø£Ùˆ Ù†Ù‚Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        alert('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!');
    });


    //animation
    $(document).ready(function () {
        function revealOnScroll() {
            $('.reveal').each(function () {
                const windowHeight = $(window).height();
                const elementTop = $(this).offset().top;
                const scrollTop = $(window).scrollTop();

                if (elementTop < scrollTop + windowHeight - 100) {
                    $(this).addClass('active');
                }
            });
        }

        revealOnScroll(); // ØªØ´ØºÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„

        $(window).on('scroll', function () {
            revealOnScroll();
        });
    });

});
